<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Selvo Labs Chat</title>

    <!-- Dialogflow CX Web Messenger -->
    <link rel="stylesheet" href="https://www.gstatic.com/dialogflow-console/fast/df-messenger/prod/v1/themes/df-messenger-default.css">
    <script src="https://www.gstatic.com/dialogflow-console/fast/df-messenger/prod/v1/df-messenger.js"></script>

    <style>
        df-messenger {
            z-index: 999;
            position: fixed;
            bottom: 16px;
            right: 16px;

            --df-messenger-font-color: #000;
            --df-messenger-font-family: Google Sans;
            --df-messenger-chat-background: #f3f6fc;
            --df-messenger-message-user-background: #d3e3fd;
            --df-messenger-message-bot-background: #fff;
        }

        #popup {
            position: fixed;
            bottom: 90px;  
            right: 95px;   
            background: white;
            padding: 12px 18px;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
            font-family: Google Sans, sans-serif;
            font-size: 15px;
            opacity: 0;
            transform: translateY(10px);
            pointer-events: none;
            transition: opacity 0.4s ease, transform 0.4s ease;
            z-index: 1000;
            white-space: nowrap;
            border-left: 4px solid #4285f4;
        }

        #popup.show {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }

        #popup.hide {
            opacity: 0;
            transform: translateY(10px);
            pointer-events: none;
        }

        #popup-close {
            position: absolute;
            top: 4px;
            right: 8px;
            background: none;
            border: none;
            font-size: 16px;
            cursor: pointer;
            color: #5f6368;
        }

        #popup-close:hover {
            color: #000;
        }
    </style>
</head>

<body>

<!-- Popup -->
<div id="popup">
    <button id="popup-close">&times;</button>
    Welcome to Selvo Labs! Want a free consulting session? Start from here!
</div>

<!-- Dialogflow widget -->
<df-messenger
    id="df-chat"
    location="us-central1"
    project-id="virtual-agent-training-476115"
    agent-id="80f40701-01b6-4ef3-b50c-c7209d4a5c04"
    language-code="en"
    max-query-length="-1">
    <df-messenger-chat-bubble chat-title="Selvo Labs Bot"></df-messenger-chat-bubble>
</df-messenger>

<script>
/* --- Show popup on page load --- */
window.addEventListener("load", () => {
    setTimeout(() => {
        document.getElementById("popup").classList.add("show");
    }, 700);
});

/* --- Close popup when close button is clicked --- */
document.getElementById("popup-close").addEventListener("click", () => {
    document.getElementById("popup").classList.remove("show");
    document.getElementById("popup").classList.add("hide");
});

/* --- Trigger "main menu" when user opens chatbot --- */
window.addEventListener("dfMessengerLoaded", () => {
    const df = document.querySelector("#df-chat");

    // MutationObserver reliably catches when the widget opens
    const observer = new MutationObserver((mutations) => {
        mutations.forEach((m) => {
            if (m.attributeName === "opened") {
                const isOpen = df.hasAttribute("opened");

                if (isOpen) {
                    // Hide the popup when chat opens
                    document.getElementById("popup").classList.remove("show");
                    document.getElementById("popup").classList.add("hide");
                    
                    // Fire your auto reply
                    df.sendQuery("main menu");
                }
            }
        });
    });

    // Watch for attribute changes (including "opened")
    observer.observe(df, { attributes: true });
});
</script>

</body>
</html>