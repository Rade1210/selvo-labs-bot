<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Selvo Labs Chat</title>

    <!-- DF Messenger -->
    <link 
      rel="stylesheet" 
      href="https://www.gstatic.com/dialogflow-console/fast/df-messenger/prod/v1/themes/df-messenger-default.css"
    >
    <script 
      src="https://www.gstatic.com/dialogflow-console/fast/df-messenger/prod/v1/df-messenger.js">
    </script>

    <style>
      df-messenger {
        z-index: 999;
        position: fixed;
        bottom: 16px;
        right: 16px;
        --df-messenger-font-color: #000;
        --df-messenger-chat-background: #f3f6fc;
        --df-messenger-message-user-background: #d3e3fd;
        --df-messenger-message-bot-background: #fff;
      }

      /* Chat Popup Bubble */
      #popup {
        position: fixed;
        bottom: 110px;
        right: 20px;
        background: white;
        padding: 12px 15px;
        border-radius: 12px;
        box-shadow: 0 3px 8px rgba(0,0,0,0.18);
        font-family: Arial, sans-serif;
        font-size: 14px;
        display: none;
        opacity: 0;
        transition: opacity 0.35s ease;
      }

      #popup.show {
        display: block;
        opacity: 1;
      }
    </style>
</head>

<body>

<!-- Popup Message -->
<div id="popup">
  Want a free consulting session?<br><strong>Start from here!</strong>
</div>

<!-- Dialogflow Messenger -->
<df-messenger
  project-id="virtual-agent-training-476115"
  agent-id="80f40701-01b6-4ef3-b50c-c7209d4a5c04"
  language-code="en"
  location="us-central1"
  max-query-length="-1">

  <df-messenger-chat-bubble chat-title="Selvo Labs Bot"></df-messenger-chat-bubble>
</df-messenger>


<script>
/* ---------------------------------------------
   1) SHOW POPUP ON PAGE LOAD
--------------------------------------------- */
window.addEventListener("load", () => {
    setTimeout(() => {
        document.getElementById("popup").classList.add("show");
    }, 600);
});


/* --------------------------------------------------
   2) SEND "main menu" ONLY after chat bubble is opened
   - This runs EXACTLY when user clicks chatbot icon
---------------------------------------------------- */
window.addEventListener("df-messenger-loaded", () => {
    const df = document.querySelector("df-messenger");
    const bubble = df.shadowRoot.querySelector("df-messenger-chat-bubble");

    bubble.addEventListener("click", () => {
        // Avoid double-triggering
        if (!sessionStorage.getItem("mainMenuSent")) {
            df.renderCustomText("main menu");  // Guaranteed working
            sessionStorage.setItem("mainMenuSent", "true");
        }
    });
});
</script>

</body>
</html>
